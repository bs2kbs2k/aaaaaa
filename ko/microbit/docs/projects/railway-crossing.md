# Railway Crossing

## ~

https://youtu.be/xBInZN2ZWRI

## 활동 소요시간

7 단계, 각 단계별 15-30 분 소요

## 단계 1: 빛 센서 코드

기차가 지나가는 것을 감지하기 위해 빛센서를 사용할 것입니다. 기차의 그림자를 감지하는 방법으로 가능합니다.

일단 먼저, 다음 프로그램을 @boardname@ 에 업로드해서, 빛센서가 어떻게 동작하는지 살펴보도록 하겠습니다.

```block
input.onButtonPressed(Button.A, () => {
    basic.showNumber(input.lightLevel())
})
```

이제 A 버튼을 누르면, 빛 센서로 읽어들인 값이 @boardname@ 로 출력됩니다. LED 스크린으로 출력되는 값은, 주변 빛의 밝기를 측정한 값을 나타내는 것입니다. (맞습니다. LED 화면은 주변 빛의 양을 측정하는 빛 센서로도 사용될 수 있습니다.) 출력된 값이 255 나 0 인 경우에는 빛 센서가 초기화되고 있는 상태를 나타내는 것입니다. 따라서, 버튼을 한 번 더 눌러야 합니다.

## 단계 2: 철도 건널목 상황

참고: 장난감 기차가 없는 경우, 장난감 자동차도 사용할 수 있으며, 심지어는 손으로 그림자를 만들어도 됩니다.

그림자를 감지하는 것은 약간 요령이 필요합니다. 그림자를 잘 감지하도록 하기 위해, 기차 건너편 쪽에 밝은 램프를 설치합니다. 단, 너무 밝은 것을 사용하지는 않습니다. 일반적인 책상등 정도면 됩니다. 그리고, 나머지 주변의 밝은 빛들은 어둡게 만들어야 합니다. 커튼을 치고, 블라인드를 내리고, 천장 등을 어둡게 만들어야 할 수도 있습니다.

이렇게 해서, @boardname@ 에 기차 그림자가 만들어지도록 해야합니다. 보드를 바닥에 눕혀, 그림자가 만들어졌을 때의 빛 센서값과, 그림자가 없을 때의 빛 센서 값을 측정해 둡니다. 그림자가 없을 때 빛 센서값은, 그림자가 있을 때의 빛 센서값보다 적어도 2배가 되어야 합니다.

## 단계 3: 기차 감지하기

![기차 감지](/static/mb/projects/railway-crossing/railway-crossing-action.png)

기차가 지나가면, @boardname@ 스크린의 가장 왼쪽 위에 있는 LED 에 불을 켤 것입니다. 기차가 지나가는지 판단하기 위해서는, 어떤 기준값(threshold)을 정해야 합니다. 그 기준값은 대략적으로, 단계 2 에서 측정한 두 가지 값의 중간에 있는 값으로 사용할 수 있습니다. 예를 들어, 그림자가 만들어졌을 때 측정한 빛 센서값이 20 이고, 그림자가 없을 때 측정한 빛 센서값이 60 인 경우, 그 중간값인 40 을 기준값(threshold)으로 사용할 수 있습니다.

기차가 지나가는 것을 감지하면, 스크린의 가장 왼쪽 위에 있는 LED 에 불을 켜기 위해서, 다음과 같은 블록들을 프로그램에 추가합니다. 기준값 40 은 여러분의 상황에 맞게 바꾸면 됩니다.

```block
basic.forever(() => {
    if (input.lightLevel() < 40) {
        led.plot(0, 0)
    } else {
        led.unplot(0, 0)
    }
})
```

자 이제 실험해보세요! 기차가 지나가지 않는데도 LED 가 켜지면, 기준값을 더 낮게 잡아야 합니다. 기차가 지나가는데 LED 가 켜지지 않는다면, 기준값을 더 높게 잡아야 합니다.

참고: 안정적인 기준값을 잡기 어려워도 다음 단계들을 계속 따라가서, 단추 눌러 철도 건널목 차단기를 내리는 방법까지 계속 할 수 있습니다.

## 단계 4: 신호등 만들기

신호등 불 빛들을 만들기 위해 다음과 같은 재료들이 필요합니다.:

- 판지 조각 (재활용품도 가능!)
- LED 2 개(되도록이면 5 mm 크기에 긴 선으로 연결된 것)
- 3 볼트 전원으로 LED 를 켤 때 사용할 수 있는 적당한 저항
- 악어 집게
- 접착제
- 테이프

https://youtu.be/No1qK51tHNQ

동영상에서는 차단기 막대를 만드는 방법을 보여줍니다. 간단 요약: - 판지를 이용해 차단 막대를 만듭니다. - 차단 막대의 아랫쪽에 저항을 추가하고, 그 위에 2 개의 LED 를 병렬로 연결합니다. 이 2 개의 LED 들은 양쪽 방향으로 붙여야 합니다. - 악어 집게들을 이용해 회로를 연결합니다. - @boardname@ 의 3V 핀과 GND 핀에 연결시킵니다. LED 중 한 개가 켜져야 합니다. - 악어 집게를 바꿔 연결했을 때, 다른 LED 가 켜져야 합니다.

## 단계 5: 신호등 깜박이기

이제 @boardname@ 를 프로그래밍해서, 실제 철도 건널목의 신호등처럼 LED 들이 깜박이도록 만들어야 합니다. 그렇게 만들기 위해서, 이전 단계에서 만들었던 LED 들을 @boardname@ 의 1 번 핀과, 2번 핀에 각각 연결할 것입니다.

디지털 출력 모드로, 하나의 LED 에는 값 1을 출력하고, 다른 LED 에는 값 0 을 출력할 수 있습니다. (디지털 출력 값 1 은 3 볼트(Volt)를 의미하고, 0 은 접지(GND, ground) 를 의미합니다.) 다른 LED 는 반대로 0 과 1 을 반복적으로 바꿔 출력하면 됩니다. 이제, LED 불빛들을 계속해서 깜박이도록 하기 위해 다음 프로그램을 사용합니다.

```block
basic.forever(() => {
    pins.digitalWritePin(DigitalPin.P1, 1)
    pins.digitalWritePin(DigitalPin.P2, 0)
    basic.pause(300)
    pins.digitalWritePin(DigitalPin.P1, 0)
    pins.digitalWritePin(DigitalPin.P2, 1)
    basic.pause(300)
})
```

## 단계 6: 철도 건널목 신호 프로그래밍

안전한 철도 건널목을 만들기 위해, 기차가 더 이상 감지되지 않아도, 5 번 정도 더 불빛을 깜박이도록 할 것입니다. 그러기 위해서는 신호등을 깜박여야하는 횟수를 기억해 사용하는 프로그램을 만들어야 합니다. 그러기 위해 `flashes_remaining` 변수를 사용합니다. 기차가 감지되면, 기차가 지나갈 때 이 변수의 값을 5 로 만들어둡니다. 그 다음에 한 번에 1 만큼씩 줄이면서 0 이 되도록 만듭니다. 그 다음에 신호등이 깜박이는 것이 멈춥니다.

그리고, B 버튼을 누르면 수동으로 철도 건널목 차단 막대기가 내려오도록 합니다. 일단, 단계 5 에서 무한 반복 실행 블록을 제거하고, 다음과 같은 코드를 추가합니다.:

```block
let flashes_remaining = 0

input.onButtonPressed(Button.B, () => {
    flashes_remaining = 5
})

basic.forever(() => {
    while (flashes_remaining > 0) {
        pins.digitalWritePin(DigitalPin.P1, 0)
        pins.digitalWritePin(DigitalPin.P2, 1)
        basic.pause(300)
        pins.digitalWritePin(DigitalPin.P1, 1)
        pins.digitalWritePin(DigitalPin.P2, 0)
        basic.pause(300)
        flashes_remaining += -1
        pins.digitalWritePin(DigitalPin.P1, 0)
    }
})
```

B 버튼을 누르면, 신호등이 5 번 깜박이게 될 것입니다. 단계 3 에서 만든 기차 감지 프로그램에, 기차가 감지되면 신호등을 계속해서 깜박이도록 하는 블록들을 붙이면 됩니다.

## 단계 7: 차단 막대 추가하기

![서보 모터를 이용한 철도 건널목](/static/mb/projects/railway-crossing/railway-crossing-with-servo.jpg)

차단 막대를 만들기 위한 준비물:

- SG90 9g 서보 1개, [악어 집게가 달려있는](../device/servo)
- 빨대 (가급적 흰색)
- 꾸미기용 빨강색 테이프

## 만드는 과정

- 서보 모터를 차단 막대기에 붙이기 위해 필요한 접착제
- 서보 모터 고정용 판지 조각을 붙이기 위한 접착제
- 빨대에 붙이기 위한 테이프
- 아래에 있는 블록을 프로그램에서 정확한 위치에 추가
- 시뮬레이터에서 보여지는 것과 같이, 서보 모터를 3V, GND, P0 핀과 연결

### 차단 막대 올리기

```block
pins.servoWritePin(AnalogPin.P0, 90)
```

### 차단 막대 내리기

```block
pins.servoWritePin(AnalogPin.P0, 180)
```

모두에게 행운이 함께하기를 바랍니다. 재미있게 즐겨보세요!

## ~

## 이 철도 건널목을 만든 원작자

이 프로젝트는 존 고터(Johan Gorter) [@JohanGorter](https://twitter.com/JohanGorter) 에 의해 제공되었습니다.